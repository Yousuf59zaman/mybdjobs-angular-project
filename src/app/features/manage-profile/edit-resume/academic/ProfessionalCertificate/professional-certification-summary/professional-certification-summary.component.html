<accordion-main-body
  [accordionName]="t('professionalCertificate.professionalCertificateSummary')"
  buttonType="add"
  buttonTitle="{{t('professionalCertificate.Add_Professional_Certification')}}"
  [isAccordionOpen]="isOpen()"
  [isFormOpen]="isProfCertificateSummaryFormOpen()"
  (formToggleEmitter)="
    isProfCertificateSummaryFormOpen.set(!isProfCertificateSummaryFormOpen())
  "
  (accordionToggleEmitter)="onExpandClick()"
  *transloco="let t"
>
  @if(isLoading()) {
  <div class="flex items-center justify-center py-[50px]">
    <img [src]="'/images/loading.gif'" alt="Loading..." />
  </div>
  } @else { @if(isInfoAvailable()) {
  <div
    class="my-5"
    *ngFor="let cert of professionalCertifications; let i = index"
  >
    <ng-container
      *ngIf="editingCertificationId === cert.pe_ID; else readModeCertification"
    >
      <h3 class="text-sm sm:text-lg font-semibold text-slate-700">
        {{t('professionalCertificate.ProfessionalCertification')}} {{ i + 1 }}
      </h3>
      <!-- Edit Form -->
      <form class="mt-5 space-y-4" [formGroup]="certificationForm">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div>
            <app-input
              [control]="certificationControl()"
              [isNumericOnly]="false"
              [label]="t('professionalCertificate.Certification')"
              [placeholder]="'Enter your Certification'"
              [isRequired]="true"
              [customClasses]="
                'w-full mt-[8px] p-2.5 text-sm text-gray-500 rounded-lg border border-gray-300 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] h-10'
              "
            ></app-input>
            @if (certificationControl().invalid &&
            certificationControl().touched) {
            <div class="text-red-500 text-xs mt-1">
              @if (certificationControl().hasError('required')) {
              <span
                >{{t("professionalCertificate.CertificationNotEmpty")}}</span
              >
              } @if (certificationControl().hasError('maxlength')) {
              <span>Maximum length exceeded (80 characters)</span>
              }
            </div>
            }
          </div>

          <div>
            <app-input
              [control]="instituteControl()"
              [isNumericOnly]="false"
              [label]="t('professionalCertificate.Institute')"
              [placeholder]="'Enter your Institute'"
              [isRequired]="true"
              [customClasses]="
                'w-full mt-[8px] p-2.5 text-sm text-gray-500 rounded-lg border border-gray-300 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] h-10'
              "
            ></app-input>
            @if (instituteControl().invalid && instituteControl().touched) {
            <div class="text-red-500 text-xs mt-1">
              @if (instituteControl().hasError('required')) {
              <span>{{t('professionalCertificate.InstituteNotEmpty')}}</span>
              } @if (instituteControl().hasError('maxlength')) {
              <span>Maximum length exceeded (80 characters)</span>
              }
            </div>
            }
          </div>
        </div>

        <div class="flex flex-wrap gap-8 items-start mt-4 w-full">
          <div class="w-full md:flex-1">
            <app-input
              [control]="locationControl()"
              [isNumericOnly]="false"
              [label]="t('professionalCertificate.Location')"
              [placeholder]="'Enter your Location'"
              [isRequired]="true"
              [customClasses]="
                'flex gap-2 items-center py-2.5 mt-2 w-full text-sm text-gray-500 rounded-lg border border-solid shadow-sm bg-white border-gray-300 px-4 h-10 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] focus:outline-none transition-colors'
              "
            ></app-input>
            
          </div>
          <!-- Duration -->
          <div class="w-full md:flex-1 relative" #editCalendarContainer>
            <div class="flex flex-col w-full">
              <label
                class="flex gap-0.5 items-start self-start text-sm font-medium leading-none"
              >
                <span class="text-sm leading-[20px] text-slate-700"
                  >{{t('professionalCertificate.Duration')}}</span
                >
                <span
                  class="text-sm text-red-600 leading-[20px]"
                  aria-hidden="true"
                  >*</span
                >
                <div class="relative inline-flex">
                  <button
                    type="button"
                    class="text-gray-400 hover:text-gray-500 focus:outline-none ml-1"
                    aria-label="Help"
                    (mouseenter)="showTooltip = true"
                    (mouseleave)="showTooltip = false"
                  >
                    <img
                      src="images/help-circle.svg"
                      alt="Help"
                      class="h-4 w-4"
                    />
                  </button>
                  @if (showTooltip) {
                  <div
                    class="absolute z-10 w-48 px-2 py-1 text-xs text-white bg-gray-800 rounded shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-1"
                  >
                    This is the duration of your experience
                    <div
                      class="absolute w-2 h-2 bg-gray-800 rotate-45 -bottom-1 left-1/2 -translate-x-1/2"
                    ></div>
                  </div>
                  }
                </div>
                <span class="sr-only">(required)</span>
              </label>

              <!-- In your edit form template -->
              <div class="relative w-full mt-2">
                <input
                  type="text"
                  required
                  aria-required="true"
                  placeholder="Select your duration month"
                  class="w-full text-sm text-gray-500 rounded-lg border border-gray-300 shadow-sm bg-white pl-9 pr-4 h-10 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] focus:outline-none transition-colors"
                  (click)="toggleEditCalendar()"
                  [value]="editDateRangeString"
                  readonly
                />
                <button
                  type="button"
                  aria-label="Open calendar"
                  class="absolute left-2.5 top-1/2 -translate-y-1/2 h-5 w-5 cursor-pointer bg-transparent border-0 p-0"
                  (click)="toggleEditCalendar($event)"
                >
                  <img
                    src="images/calendar.svg"
                    alt="Calendar icon"
                    class="h-5 w-5"
                  />
                </button>
              </div>
              @if (editCalendarVisible) {
              <app-date-range-picker
                [(selectedStartDate)]="editSelectedStartDate"
                [(selectedEndDate)]="editSelectedEndDate"
                (selectedStartDateChange)="onEditStartDateChange($event)"
                (selectedEndDateChange)="onEditEndDateChange($event)"
                (selectedStartDateChange)="confirmEditSelection()"
                (selectedEndDateChange)="confirmEditSelection()"
              >
              </app-date-range-picker>
              } @if (certificationForm.touched) {
              <div class="space-y-1 mt-1">
                @if (certificationForm.get('startDate')?.hasError('required') ||
                certificationForm.get('endDate')?.hasError('required')) {
                <div class="text-red-500 text-xs">Duration is required</div>
                } @if (certificationForm.errors?.['dateRangeInvalid']) {
                <div class="text-red-500 text-xs">
                  End date must be after start date
                </div>
                }
              </div>
              }
            </div>
          </div>
        </div>

        <div class="mb-3 flex items-center gap-3">
          <button
            (click)="saveCertification()"
            class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#ffffff1f] bg-[#C63C92] text-white text-sm font-semibold"
          >
            {{t('professionalCertificate.Save')}}
          </button>
          <button
            (click)="closeCertificationForm()"
            class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#D0D5D] text-[#344054] text-sm font-semibold"
          >
            {{t('professionalCertificate.Close')}}
          </button>
        </div>
      </form>
    </ng-container>

    <ng-template #readModeCertification>
      <!-- Read Mode -->
      <div class="flex flex-wrap justify-between items-center gap-4">
        <h3 class="text-sm sm:text-lg font-semibold text-slate-700">
          {{t('professionalCertificate.ProfessionalCertification')}} {{ i + 1 }}
        </h3>
        <div class="flex gap-4 items-center">
          <button
            class="flex items-center gap-1.5 text-[#B32D7D]"
            aria-label="Edit Professional Certification 1"
            (click)="editCertification(cert)"
          >
            <img src="images/edit-05.svg" class="h-[15px] w-[15px]" />
            <span class="text-sm hidden sm:inline">{{t('professionalCertificate.Edit')}}</span>
          </button>
          <button
            class="flex items-center gap-1.5 text-slate-600"
            aria-label="Delete Professional Certification 1"
            (click)="openDeleteModal(cert.pe_ID)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              class="w-4 h-4"
            >
              <path
                d="M2 4H3.33333H14"
                stroke="#334155"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M5.33325 4V2.66667C5.33325 2.48986 5.40349 2.32029 5.52851 2.19526C5.65354 2.07024 5.82311 2 5.99992 2H9.99992C10.1767 2 10.3463 2.07024 10.4713 2.19526C10.5963 2.32029 10.6666 2.48986 10.6666 2.66667V4"
                stroke="#334155"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M12.6666 4V13.3333C12.6666 13.5101 12.5963 13.6797 12.4713 13.8047C12.3463 13.9298 12.1767 14 11.9999 14H3.99992C3.82311 14 3.65354 13.9298 3.52851 13.8047C3.40349 13.6797 3.33325 13.5101 3.33325 13.3333V4"
                stroke="#334155"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M6.66675 7.33334V11.3333"
                stroke="#334155"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M9.33325 7.33334V11.3333"
                stroke="#334155"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <span class="text-sm hidden sm:inline">{{t('professionalCertificate.JustDelete')}}</span>
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4">
        <div>
          <p class="text-sm text-gray-500">{{t('professionalCertificate.Certification')}}</p>
          <p class="mt-1 text-sm font-medium text-gray-900">
            {{ cert?.certificationTitle || "---" }}
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-500">{{t('professionalCertificate.Institute')}}</p>
          <p class="mt-1 text-sm font-medium text-gray-900">
            {{ cert?.institute || "---" }}
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-500">{{t('professionalCertificate.Location')}}</p>
          <p class="mt-1 text-sm font-medium text-gray-900">
            {{ cert?.location || "---" }}
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-500">{{t('professionalCertificate.Duration')}}</p>
          <p class="mt-1 text-sm font-medium text-gray-900">
            {{ cert?.fromDate ? (cert.fromDate | date : "M/d/yyyy") : "---" }}
            to
            {{ cert?.toDate ? (cert.toDate | date : "M/d/yyyy") : "---" }}
          </p>
        </div>
      </div>
    </ng-template>
  </div>

  <div [ngClass]="isProfCertificateSummaryFormOpen() ? 'mb-0' : 'mb-5'">
    <button
      (click)="showCertificationForm()"
      class="flex overflow-hidden gap-1 justify-center items-center px-3.5 py-2.5 text-sm font-semibold leading-none text-[#B32D7D] bg-white rounded-lg border border-solid shadow-sm border-[#F0B1DE] focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 mt-8 hover:bg-pink-50 transition-colors"
      aria-label="Add Professional Certification"
    >
      <img src="images/plus.svg" alt="Add" />
      <span class="leading-tight sm:inline hidden"
        >{{t('professionalCertificate.Add_Professional_Certification')}}</span
      >
      <span class="leading-tight sm:hidden inline">Add</span>
    </button>
  </div>

  <div [hidden]="!isProfCertificateSummaryFormOpen()" class="my-5">
    @if(isNewFormOpen() || isInfoAvailable())
    {
      <h3 class="text-lg font-semibold text-slate-700">
      {{t('professionalCertificate.ProfessionalCertification')}}
      {{
        professionalCertifications.length === 45
          ? 1
          : professionalCertifications.length + 1
      }}
    </h3>
    
      <form class="mt-5 space-y-4" [formGroup]="newCertificationForm">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <app-input
            [control]="newcertificationControl()"
            [isNumericOnly]="false"
            [label]="t('professionalCertificate.Certification')"
            [placeholder]="'Enter your Certification'"
            [isRequired]="true"
            [customClasses]="
              'w-full mt-[8px] p-2.5 text-sm text-gray-500 rounded-lg border border-gray-300 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] h-10'
            "
          ></app-input>
          <div class="text-red-500 text-xs mt-1">
            @if ( newcertificationControl().invalid &&
            (newcertificationControl().touched) ) { @if
            (newcertificationControl().hasError('required')) {
            <span>{{t('professionalCertificate.CertificationNotEmpty')}}</span>
            } @if (newcertificationControl().hasError('maxlength')) {
            <span>Maximum length exceeded (80 characters)</span>
            } }
          </div>
        </div>

        <div>
          <app-input
            [control]="newinstituteControl()"
            [isNumericOnly]="false"
            [label]="t('professionalCertificate.Institute')"
            [placeholder]="'Enter your Institute'"
            [isRequired]="true"
            [customClasses]="
              'w-full mt-[8px] p-2.5 text-sm text-gray-500 rounded-lg border border-gray-300 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] h-10'
            "
          ></app-input>
          <div class="text-red-500 text-xs mt-1">
            @if ( newinstituteControl().invalid &&
            (newinstituteControl().touched || newinstituteControl().touched) ) {
            @if (newinstituteControl().hasError('required')) {
            <span>Institution is required</span>
            } @if (newinstituteControl().hasError('maxlength')) {
            <span>Maximum length exceeded (80 characters)</span>
            } }
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-8 items-start mt-4 w-full">
        <div class="w-full md:flex-1">
          <app-input
            [control]="newlocationControl()"
            [isNumericOnly]="false"
            [label]="t('professionalCertificate.Location')"
            [placeholder]="'Enter your Location'"
            [isRequired]="true"
            [customClasses]="
              'flex gap-2 items-center py-2.5 mt-2 w-full text-sm text-gray-500 rounded-lg border border-solid shadow-sm bg-white border-gray-300 px-4 h-10 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] focus:outline-none transition-colors'
            "
          ></app-input>
          <div class="text-red-500 text-xs mt-1">
            @if ( newlocationControl().invalid && (newlocationControl().touched
            || newlocationControl().touched) ) { @if
            (newlocationControl().hasError('required')) {
            <span>Location is required</span>
            } @if (newlocationControl().hasError('maxlength')) {
            <span>Maximum length exceeded (80 characters)</span>
            } }
          </div>
        </div>

        <!-- Duration -->
        <!-- In the new certification form template (replace the existing duration section) -->
        <div class="w-full md:flex-1 relative" #newCalendarContainer>
          <div class="flex flex-col w-full">
            <label
              class="flex gap-0.5 items-start self-start text-sm font-medium leading-none"
            >
              <span class="text-sm leading-[20px] text-slate-700"
                >Duration</span
              >
              <span
                class="text-sm text-red-600 leading-[20px]"
                aria-hidden="true"
                >*</span
              >
              <div class="relative inline-flex">
                <button
                  type="button"
                  class="text-gray-400 hover:text-gray-500 focus:outline-none ml-1"
                  aria-label="Help"
                  (mouseenter)="showTooltip = true"
                  (mouseleave)="showTooltip = false"
                >
                  <img
                    src="images/help-circle.svg"
                    alt="Help"
                    class="h-4 w-4"
                  />
                </button>
                @if (showTooltip) {
                <div
                  class="absolute z-10 w-48 px-2 py-1 text-xs text-white bg-gray-800 rounded shadow-lg bottom-full left-1/2 transform -translate-x-1/2 mb-1"
                >
                  This is the duration of your experience
                  <div
                    class="absolute w-2 h-2 bg-gray-800 rotate-45 -bottom-1 left-1/2 -translate-x-1/2"
                  ></div>
                </div>
                }
              </div>
              <span class="sr-only">(required)</span>
            </label>

            <div class="relative w-full mt-2">
              <input
                type="text"
                required
                aria-required="true"
                placeholder="Select your duration month"
                class="w-full text-sm text-gray-500 rounded-lg border border-gray-300 shadow-sm bg-white pl-9 pr-4 h-10 focus:border-[#C63C92] focus:ring-1 focus:ring-[#C63C92] focus:outline-none transition-colors"
                (click)="toggleNewCalendar()"
                [value]="newDateRangeString"
                readonly
              />
              <button
                type="button"
                aria-label="Open calendar"
                class="absolute left-2.5 top-1/2 -translate-y-1/2 h-5 w-5 cursor-pointer bg-transparent border-0 p-0"
                (click)="toggleNewCalendar($event)"
              >
                <img
                  src="images/calendar.svg"
                  alt="Calendar icon"
                  class="h-5 w-5"
                />
              </button>
            </div>
            @if (newCalendarVisible) {
            <app-date-range-picker
              [(selectedStartDate)]="newSelectedStartDate"
              [(selectedEndDate)]="newSelectedEndDate"
              (selectedStartDateChange)="onNewStartDateChange($event)"
              (selectedEndDateChange)="onNewEndDateChange($event)"
              (closePicker)="newCalendarVisible = false"
            >
            </app-date-range-picker>
            }
            <div *ngIf="newCertificationForm.touched" class="space-y-1 mt-1">
              <!-- Required check -->
              <div
                class="text-red-500 text-xs"
                *ngIf="
                  newCertificationForm.get('startDate')?.hasError('required') ||
                  newCertificationForm.get('endDate')?.hasError('required')
                "
              >
                Duration is required
              </div>

              <!-- Date‐range invalid check -->
              <div
                class="text-red-500 text-xs"
                *ngIf="newCertificationForm.hasError('dateRangeInvalid')"
              >
                End date must be after start date
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mb-3 flex items-center gap-3">
        <button
          (click)="addCertification()"
          [disabled]="isSaving()"
          class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#ffffff1f] bg-[#C63C92] text-white text-sm font-semibold"
        >
          {{t('professionalCertificate.Save')}}
        </button>
        <button
          (click)="closeNewCertificationForm()"
          class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#D0D5D] text-[#344054] text-sm font-semibold"
        >
          {{t('professionalCertificate.Close')}}
        </button>
      </div>
    </form>
    }
    
  </div>
  @if(isDeleteModalOpen()){
  <div
    class="fixed inset-0 bg-[#101828]/50 flex items-center justify-center z-[9999]"
  >
    <div
      class="bg-white w-[476px] h-[216px] p-10 rounded-lg shadow-md flex flex-col justify-between"
    >
      <p
        class="text-primary-900 text-center font-semibold text-[24px] leading-[32px]"
      >
        {{t('professionalCertificate.AreYouSure')}}
      </p>
      <div class="flex justify-center gap-6 mt-6">
        <button
          (click)="closeDeleteModal()"
          class="px-4 py-2 text-sm rounded-lg border border-[#E4E7EC] bg-white shadow-sm text-primary-900 hover:bg-gray-100"
        >
          {{t('professionalCertificate.Cancel')}}
        </button>
        <button
          (click)="confirmDelete()"
          class="px-4 py-2 text-sm rounded-lg bg-[#C63C92] shadow-sm text-white hover:bg-pink-700"
        >
          {{t('professionalCertificate.Delete')}}
        </button>
      </div>
    </div>
  </div>
  }  
}
@else {
  <app-no-details
    (openFormBtn)="openCertificationData()"
    [btnText]="'Add data'"
    [description]="'no data found'"
  ></app-no-details>
  } 
  }
</accordion-main-body>
