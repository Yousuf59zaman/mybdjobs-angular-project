<div *transloco="let t">

<accordion-main-body [accordionName]="t('editResumeLinkAccount.headline')" buttonType="add" buttonTitle="{{t('editResumeLinkAccount.addAcc')}}"
  [isAccordionOpen]="isOpen()" [isFormOpen]="isFormOpen()" (formToggleEmitter)="toggleForm()"
  (accordionToggleEmitter)="toggle()">
  <!-- Existing Linked Accounts -->
  <div class="my-5 space-y-6">
    @if (isLoading) {
      <div class="flex items-center justify-center py-12">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#C63C92]"></div>
      </div>
    } @else if (!isInfoAvailable && !isFormOpen()) {
      <div class="mb-5">
        <app-no-details (openFormBtn)="isFormOpen.set(true)" [btnText]="t('editResumeLinkAccount.Addlink')"
          [description]="t('editResumeLinkAccount.noData')"></app-no-details>
      </div>
    } @else {
      <!-- Show accounts when data is available -->
      @for (account of linkAccount; track account.otherProfileId) {
        <div>
          <div class="flex flex-wrap justify-between items-center gap-4">
            <!-- Account details section -->
            <div class="flex-1 min-w-[200px]">
              <!-- Show account details when NOT in edit mode -->
              <div *ngIf="editingAccount?.otherProfileId !== account.otherProfileId" class="grid grid-cols-2 gap-4">
                <div class="flex items-center gap-2">
                  <div class="flex items-center justify-center rounded-full bg-gray-100 px-3 py-1 space-x-2">
                    <img [src]="getPlatformIcon(account.profileType)" class="w-4 h-4" alt="platform icon">
                    <span class="text-sm font-medium text-gray-900">{{ account.profileType }}</span>
                  </div>
                </div>
                <div>
                  <p class="mt-1 text-sm font-medium text-gray-900">{{ account.profileUrl }}</p>
                </div>
              </div>
            </div>

            <!-- Action buttons -->
            <div class="flex gap-4 items-center" *ngIf="editingAccount?.otherProfileId !== account.otherProfileId">
              <!-- Edit Button -->
              <button class="flex items-center gap-1.5 text-[#B32D7D]" aria-label="Edit Account"
                (click)="editAccount(account)">
                <img src="images/edit-05.svg" class="h-[15px] w-[15px]">
                <span class="text-sm hidden sm:inline">{{t('editResumeLinkAccount.edit')}}</span>
              </button>

              <!-- Delete Button -->
              <button class="flex items-center gap-1.5 text-slate-600" aria-label="Delete Account"
                (click)="openDeleteModal(account.otherProfileId)">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none"
                  class="w-4 h-4">
                  <path d="M2 4H3.33333H14" stroke="#334155" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path
                    d="M5.33325 4V2.66667C5.33325 2.48986 5.40349 2.32029 5.52851 2.19526C5.65354 2.07024 5.82311 2 5.99992 2H9.99992C10.1767 2 10.3463 2.07024 10.4713 2.19526C10.5963 2.32029 10.6666 2.48986 10.6666 2.66667V4"
                    stroke="#334155" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path
                    d="M12.6666 4V13.3333C12.6666 13.5101 12.5963 13.6797 12.4713 13.8047C12.3463 13.9298 12.1767 14 11.9999 14H3.99992C3.82311 14 3.65354 13.9298 3.52851 13.8047C3.40349 13.6797 3.33325 13.5101 3.33325 13.3333V4"
                    stroke="#334155" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                  <path d="M6.66675 7.33334V11.3333" stroke="#334155" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path d="M9.33325 7.33334V11.3333" stroke="#334155" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
                <span class="text-[#B32D7D] font-semibold text-sm cursor-pointer">{{t('editResumeLinkAccount.delete')}}</span>
              </button>
            </div>
          </div>

          <!-- Show edit form when this account is being edited -->
          <div *ngIf="editingAccount?.otherProfileId === account.otherProfileId" class="mt-4">
            <form class="space-y-4" [formGroup]="linkFrom">
              <div class="grid grid-cols-2 gap-8 w-full">
                <div class="col-span-1">
                  <app-selectbox [options]="platformOptions()" [label]="t('editResumeLinkAccount.chooseAcc')" [control]="platformControl"
                    [isRequired]="true" [placeholder]="'Select Choose Account'" >
                  </app-selectbox>
                   @if (platformControl.invalid && (platformControl.dirty || platformControl.touched)) {
                    <div class="text-red-500 text-sm mt-1">Please enter account</div>
                  }
                </div>

                <div class="col-span-1">
                  <app-input [label]="'URL'" [control]="urlControl" [isNumericOnly]="false" [isRequired]="true"
                    [placeholder]="'Enter URL'">
                  </app-input>
                   @if (urlControl.invalid && (urlControl.dirty || urlControl.touched)) {
                    <div class="text-red-500 text-sm mt-1">Please enter url</div>
                  }
                </div>
              </div>

              <div class="flex items-center gap-3 pt-2">
                <button (click)="saveAccount()"
                  class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#ffffff1f] bg-[#C63C92] text-white text-sm font-semibold">
                  Update
                </button>
                <button type="button" (click)="cancelEdit()"
                  class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#D0D5D] text-[#344054] text-sm font-semibold">
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      }
    }
  </div>

  <!-- Add New Form (only shown when not editing any account) -->
  <div class="my-5" *ngIf="isFormOpen() && !editingAccount && linkAccount.length < 3">
    <form class="space-y-4" [formGroup]="linkFrom">
      <div class="grid grid-cols-2 gap-8 w-full">
        <div class="col-span-1">
          <app-selectbox [options]="platformOptions()" [label]="t('editResumeLinkAccount.chooseAcc')" [control]="platformControl"
            [isRequired]="true" [placeholder]="'Select Choose Account'">
          </app-selectbox>
           @if (platformControl.invalid && (platformControl.dirty || platformControl.touched)) {
                    <div class="text-red-500 text-sm mt-1">Please enter account</div>
                  }
        </div>

        <div class="col-span-1">
          <app-input [label]="'URL'" [control]="urlControl" [isNumericOnly]="false" [isRequired]="true"
            [placeholder]="'Enter URL'">
          </app-input>
           @if (urlControl.invalid && (urlControl.dirty || urlControl.touched)) {
                    <div class="text-red-500 text-sm mt-1">Please enter url</div>
                  }
        </div>
      </div>

      <div class="flex items-center gap-3 pt-2">
        <button (click)="saveAccount()"
          class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#ffffff1f] bg-[#C63C92] text-white text-sm font-semibold">
          {{t('editResumeLinkAccount.save')}}
        </button>
        <button type="button" (click)="closeForm()"
          class="flex-1 w-full sm:max-w-fit px-5 py-2.5 rounded-lg shadow-skeuomorphic border border-[#D0D5D] text-[#344054] text-sm font-semibold">
          {{t('editResumeLinkAccount.close')}}
        </button>
      </div>

      <div class="mt-4">
        <button
          class="flex overflow-hidden gap-1 justify-center items-center px-3.5 py-2.5 text-sm font-semibold leading-none text-[#B32D7D] bg-white rounded-lg border border-solid shadow-sm border-[#F0B1DE] focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 hover:bg-pink-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Add Language" (click)="isFormOpen.set(true); resetForm()" disabled>
          <img src="images/plus.svg" alt="Add" />
          <span class="leading-tight">{{t('editResumeLinkAccount.Addlink')}}</span>
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="isInfoAvailable && !isFormOpen() && !editingAccount  && linkAccount.length < 3" class="mb-5">
    <button
      class="flex overflow-hidden gap-1 justify-center items-center px-3.5 py-2.5 text-sm font-semibold leading-none text-[#B32D7D] bg-white rounded-lg border border-solid shadow-sm border-[#F0B1DE] focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-50 hover:bg-pink-50 transition-colors"
      aria-label="Add Account" (click)="openForm()" [disabled]="isLoading">
      <img src="images/plus.svg" alt="Add" />
      <span class="leading-tight">{{t('editResumeLinkAccount.Addlink')}}</span>
    </button>
  </div>
</accordion-main-body>

@if(isDeleteModalOpen()){
<div class="fixed inset-0 bg-[#101828]/50 flex items-center justify-center z-[9999]">
  <div class="bg-white w-[476px] h-[216px] p-10 rounded-lg shadow-md flex flex-col justify-between">
    <p class="text-primary-900 text-center font-semibold text-[24px] leading-[32px]">
      {{t('editResumeLinkAccount.deleteMsg')}}
    </p>
    <div class="flex justify-center gap-6 mt-6">
      <button (click)="closeDeleteModal()"
        class="px-4 py-2 text-sm rounded-lg border border-[#E4E7EC] bg-white shadow-sm text-primary-900 hover:bg-gray-100">
        {{t('editResumeLinkAccount.cancel')}}
      </button>
      <button (click)="confirmDelete()"
        class="px-4 py-2 text-sm rounded-lg bg-[#C63C92] shadow-sm text-white hover:bg-pink-700">
        {{t('editResumeLinkAccount.deletePop')}}
      </button>
    </div>
  </div>
</div>
}
</div>