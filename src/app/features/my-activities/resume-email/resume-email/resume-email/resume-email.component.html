<div class="w-full pl-[15px] pr-[15px] pb-4" *transloco="let t">
    <div class="panel-heading panel-heading-01 flex items-center bg-[#4A5A6A] p-[10px_15px] w-[815.5px]">
        <i class="icon-emailed-resume text-white mr-[10px]"></i>
        <span role="heading" aria-level="1"
            class="text-white text-[18px] font-bold">{{t('resumeEmail.headline')}}</span>
    </div>
    <div class="w-[815.5px] p-5 bg-white">
        <div class="mb-3  bg-white">
            <p style="color: #333; font-size: 15px; color: #595959; line-height: 1.5;">
                {{t('resumeEmail.paragraph')}}
            </p>
        </div>
        <div class="flex text-sm overflow-x-auto bg-white rounded-sm"
            style="background-color: #F3F4F6; border-radius: 8px; padding: 20px;">

            <form class="w-full" [formGroup]="searchForm">
                <div class="flex flex-wrap gap-4 text-[#595959]">
                    <div class="w-full md:flex-1">
                        <label for="from-date"
                            class="font-bold text-[#595959] text-sm">{{t('resumeEmail.fromDate')}}</label>
                        <app-datepicker [widthClass]="'w-full'" [pickerType]="'calendar'" [isRequired]="true"
                        [control]="FromDate()" [minDate]="searchMinDate"  placeholder="{{t('resumeEmail.selectDate')}}">
                        </app-datepicker>
                    </div>

                    <div class="w-full md:flex-1">
                        <label for="to-date"
                            class="font-bold text-[#595959] text-sm">{{t('resumeEmail.toDate')}}</label>
                        <app-datepicker 
                            [widthClass]="'w-full'" 
                            [pickerType]="'calendar'" 
                            [isRequired]="true"
                            [control]="SearchToDate()"
                            [minDate]="searchMinDate"
                            placeholder="{{t('resumeEmail.selectDate')}}">
                        </app-datepicker>
                    </div>

                    <div class="w-full md:flex-1">
                        <label for="subject"
                            class="font-bold text-[#595959] text-sm">{{t('resumeEmail.subject')}}</label>
                        <app-input [type]="'text'" 
                            [maxLength]="100" 
                            [control]="SearchSubjectName()"
                            [isNumericOnly]="false"
                            placeholder="{{t('resumeEmail.typeSubject')}}">
                        </app-input>
                    </div>

                    <div class="w-full md:flex-1">
                        <label for="cv-type"
                                class="font-bold text-[#595959] text-sm mb-2">{{t('resumeEmail.cvType')}}</label>
                            <app-select class="-my-1" 
                                [control]="cvType()" 
                                    [placeholder]="t('resumeEmail.select')" 
                                    [options]="cvTypes" [falseOption]="false" 
                                    optionValue="value"
                                    optionLabel="label">
                        </app-select>
                    </div>
                </div>

                <div class="w-full text-center">
                    <button type="submit"
                    class="font-semibold p-[5px_60px] text-[14px] mt-[30px] bg-[#008020] text-white border rounded"
                        (click)="onSearch()">{{t('resumeEmail.search')}}</button>
                </div>
                
            </form>
        </div>
        @if (results.length === 0) {
            <app-no-matched-history></app-no-matched-history>
        } @else {
        <div class="mt-6">
            <div class="pb-1">
                <span class="text-[15px] font-bold text-[#444]">{{t('resumeEmail.cvEmailed')}}: {{count}}</span>
            </div>
            <div class="w-full overflow-x-auto text-[#444]">
                <table class="w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-[#D9D9D9] text-[13px]  w-full">
                            <th class="w-[25%] text-left px-4 py-3 rounded-tl-[3px]">{{t('resumeEmail.subject')}}</th>
                            <th class="w-[28%] text-left">{{t('resumeEmail.emailTo')}}</th>
                            <th class="w-[22%] text-center">{{t('resumeEmail.emailedOn')}}</th>
                            <th class="w-[20%] text-left px-4 py-3">{{t('resumeEmail.cvType')}}</th>
                            <th class="w-[10%] p-0 rounded-tr-md">
                                <button (click)="showDeleteModal()"
                                    class="text-[12px] py-1 px-2 mr-[15px] border-none text-gray-200 bg-[#921f1f] hover:bg-gray-100 p-1 rounded transition">
                                    <span class="icon-trush-can mr-2"></span>{{t('resumeEmail.delete')}}
                                </button>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (results && results.length > 0) {
                        @for (item of results; track item; let i = $index) {
                        <tr class="border-b border-gray-300 text-[14px]">
                            <td>
                                <div class="flex items-center gap-2 p-2">
                                    <span class="text-gray-500">{{((currentPage - 1) * pageSize) + i + 1}}.</span>
                                    <span>{{ item.emailSubject }}</span>
                                </div>
                            </td>
                            <td>{{ item.emailTo }}</td>
                            <td>
                                <div class="flex items-center gap-2 p-2">
                                    <i class="icon-calendar"></i>
                                    <span>{{ item.emailedOn | date:'dd MMM yyyy' }}</span>
                                </div>
                            </td>
                            <td>
                                @if (item.attachment === 'True') {
                                <div class="flex justify-center items-center">
                                    <i class="icon-ownformat-resume"></i>
                                </div>
                                } @else {
                                <div class="flex justify-center items-center">
                                    <i class="icon-file"></i>
                                </div>
                                }
                            </td>
                            <td>
                                <div class="flex justify-center items-center">
                                    <app-checkbox 
                                        [widthClass]="'w-4 h-4'" 
                                        [control]="deleteControl"
                                        (change)="onCheckboxChange(item.id, $event)">
                                    </app-checkbox>
                                </div>
                            </td>
                        </tr>
                        }
                        } @else {

                        <tr>
                            <td colspan="5">
                                <div class="col-md-12">
                                    <div class="not-found"
                                        style="border: 1px solid #cecece; border-radius: 4px; padding: 20px; margin: 0 0 10px 0; color: #707070; text-align: center;">
                                        <div class="icowrap" style="font-size: 64px">
                                            <span class="icon-file-times" aria-hidden="true"
                                                style="color: #707070"></span>
                                        </div>
                                        <div id="error-text"
                                            style="font-size: 20px; font-weight: 700; margin-top: 30px;">No list found.
                                        </div>
                                        <div class="insmsg"
                                            style="font-size: 18px; font-weight: 400; margin-top: 15px;">
                                            Please, modify your filters to get more results.
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>

                <!-- No Selection Popup -->
                @if (showNoSelectionPopup) {
                    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
                        <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-xs">
                            <div class="text-center">
                                <p class="text-gray-700 mb-4">Please select any email to delete</p>
                                <button 
                                    (click)="closeNoSelectionPopup()"
                                    class="px-4 py-2 bg-gray-300 text-black rounded hover:bg-gray-400 transition"
                                >
                                    OK
                                </button>
                            </div>
                        </div>
                    </div>
                }

                <!-- Delete Confirmation Popup -->
                @if (showDeleteConfirm) {
                <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
                    
                    <div class="relative bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 p-6 transform transition-all duration-300 ease-out animate-shake"
                        role="dialog" aria-labelledby="delete-modal-title">
                        <div class="flex items-center space-x-3 mb-4">
                            <i class="icon-trush-can text-red-600 text-3xl"></i>
                            <h2 id="delete-modal-title"
                                class="text-2xl font-bold text-gray-800 cursor-pointer select-none">
                                Delete!
                            </h2>
                        </div>

                        <p class="text-gray-700 mb-6">
                            Are you sure you want to delete this record?
                        </p>

                        <div class="flex justify-end space-x-4">
                            <button (click)="cancelDelete()"
                                class="px-4 py-2 uppercase text-gray-600 hover:text-gray-800 transition">
                                Cancel
                            </button>
                            <button (click)="confirmDelete()"
                                class="px-5 py-2 uppercase bg-red-600 text-white rounded shadow hover:bg-red-700 transition">
                                Yes, delete
                            </button>
                        </div>
                    </div>
                </div>
                }
            </div>
        </div>
    }
        <app-pagination-table
            [totalItems]="totalItems"
            [itemsPerPage]="pageSize"
            [currentPage]="currentPage"
            (pageChanged)="onPageChange($event)">
        </app-pagination-table>
    </div>
</div>